---
title: "Lab_book_12_2_16"
author: "Claire Green"
output: pdf_document
---

#Monday

I have now completed my second attempt at a literature review. This will be uploaded to the repository. Now that this is finished my next step is to look at creating a statistically robust protocol for generating lists of DEGs. 

###Notes for meeting with Wenbin

Data: Affy HG Plus 2.0 RNA expression (except FTLD - HG U133A 2.0)

C9orf72 motor neurons: 8 patients, 3 controls
CHMP2B motor neurons: 3 patients, 6 controls
sALS motor neurons: 7 patients, 3 controls
FTLD cortical neurons: 16 patients, 8 controls
VCP muscle: 7 patients, 3 controls

R script

1. Run each data set through Wenbin's code individually
2. Take top X most DEGs --> Do I rank by fold change, pvalue or adjusted p value?
3. Find genes that are consensus across all data sets --> which genes are commonly dysregulated?
4. Validate number is more than you would expect by chance by random permutations test
    + say top 2000 from each data set yields 10 common genes
    + take 5 sets of 2000 random genes
    + calculate consensus value
    + repeat 10,000 times
    + number of times value is >10 / 10,000 should equal p value (less than 0.05 is acceptable)
    

#Tuesday

I discussed with Wenbin about the optimal way of ordering DEGs, and he essentially said that different people have different methods. I decided then to compare my output of DEGs ordered by adjusted p value as compared to fold change. Expression was calculated by WenBin DE Gene.R and sorted using the following lines of code:

```{r, eval=FALSE}
###Write results to CSV files for consensus analysis
setwd("/Users/clairegreen/Documents/PhD/TDP-43/TDP-43_Data/DE Genes/TopGenes_2016-02-09/")
# dir.create(paste("TopGenes", Sys.Date(), sep = "_"))
#Take results, remove duplicate rows for genes, order by adjusted p value and take top X number of genes
uniqueresult <- result[!duplicated(result[,15]),]

#For ordering by adjusted p value

genesort <- uniqueresult[order(uniqueresult$adj.P.Val),]
topgene <- genesort[1:1000,]
write.csv(x = topgene, file = "VCP_ap_1000")
topgene <- genesort[1:2000,]
write.csv(x = topgene, file = "VCP_ap_2000")
topgene <- genesort[1:3000,]
write.csv(x = topgene, file = "VCP_ap_3000")
topgene <- genesort[1:4000,]
write.csv(x = topgene, file = "VCP_ap_4000")
topgene <- genesort[1:5000,]
write.csv(x = topgene, file = "VCP_ap_5000")

#For ordering by fold change
genesort <- uniqueresult[order(uniqueresult$`Fold Change`),]
topgene <- genesort[1:500,]

genesort <- uniqueresult[order(-uniqueresult$`Fold Change`),]
botgene <- genesort[1:500,]

topFC <- rbind(topgene,botgene)

write.csv(x = topgene, file = "VCP_fc_1000")
```

I evaluated consensus using the file DE consensus.R. It is as follows:

```{r}
#####DIFFERENTIAL GENE EXPRESSION INTERSECT
#takes csv files of top X DE genes and identifies any consensus genes 

setwd("/Users/clairegreen/Documents/PhD/TDP-43/TDP-43_Data/DE Genes/TopGenes_2016-02-09/")
A <- read.csv(file = "VCP_ap_1000")

B <- read.csv(file = "VCP_fc_1000")

# sALS<- read.csv(file = "sALS_anno_5000")
# 
# FTLD<- read.csv(file = "FTLD_anno_5000")
# 
# VCP<- read.csv(file = "VCP_anno_5000")


C9_DE<- A$Gene.Symbol
CHMP2B_DE <- B$Gene.Symbol
# sALS_DE <- sALS$Gene.Symbol
# FTLD_DE <- FTLD$Gene.Symbol
# VCP_DE <- VCP$Gene.Symbol
overlap <- Reduce(intersect, list(C9_DE, CHMP2B_DE))
print(overlap)
```
